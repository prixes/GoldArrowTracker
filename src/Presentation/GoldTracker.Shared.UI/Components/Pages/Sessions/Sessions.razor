@page "/sessions"
@namespace GoldTracker.Shared.UI.Components.Pages.Sessions
@using Archery.Shared.Models

<MudContainer MaxWidth="MaxWidth.False" Class="pa-4 archery-container">
    <MudText Typo="Typo.h5" Class="mb-4 font-weight-bold">Sessions</MudText>

    @if (_isLoading)
    {
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" Class="align-self-center my-4" />
    }
    else if (!_sessions.Any())
    {
        <MudPaper Class="pa-8 d-flex flex-column align-center justify-center mud-width-full" Elevation="0" Style="background: transparent; border: 1px dashed var(--mud-palette-lines-default);">
            <MudIcon Icon="@Icons.Material.Filled.History" Size="Size.Large" Color="Color.Default" Class="mb-4" Style="opacity: 0.5;" />
            <MudText Typo="Typo.h6" Align="Align.Center" Color="Color.Default" Style="opacity: 0.7;">No sessions yet</MudText>
            <MudText Typo="Typo.body2" Align="Align.Center" Color="Color.Default" Class="mb-4" Style="opacity: 0.5;">Start a new practice session to track your progress.</MudText>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" OnClick="StartNewSession">Start Session</MudButton>
        </MudPaper>
    }
    else
    {
        <MudGrid>
            @foreach (var session in _sessions)
            {
                <MudItem xs="12">
                    <MudCard Elevation="2" Class="rounded-lg cursor-pointer" @onclick="() => NavigateToSession(session.Id)">
                        <MudCardHeader>
                            <CardHeaderContent>
                                <MudText Typo="Typo.subtitle1" Class="font-weight-bold">@session.StartTime.ToString("MMM dd, yyyy - HH:mm")</MudText>
                                @if (!string.IsNullOrEmpty(session.Topic))
                                {
                                    <MudText Typo="Typo.body2" Color="Color.Secondary">@session.Topic</MudText>
                                }
                            </CardHeaderContent>
                            <CardHeaderActions>
                                <MudChip T="string" Color="Color.Primary" Variant="Variant.Text" Size="Size.Small">@session.TotalScore pts</MudChip>
                            </CardHeaderActions>
                        </MudCardHeader>
                        <MudCardContent Class="py-2">
                             <MudStack Row="true" Spacing="4">
                                <MudText Typo="Typo.caption">
                                    <b>@session.Ends.Count</b> Ends
                                </MudText>
                                <MudText Typo="Typo.caption">
                                    <b>@session.TotalArrows</b> Arrows
                                </MudText>
                                <MudText Typo="Typo.caption">
                                    <b>@session.ArrowAverage.ToString("F1")</b> Avg
                                </MudText>
                             </MudStack>
                        </MudCardContent>
                    </MudCard>
                </MudItem>
            }
        </MudGrid>
    }
    
    <MudFab Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" Style="position: fixed; bottom: 86px; right: 16px;" OnClick="StartNewSession" />

</MudContainer>
