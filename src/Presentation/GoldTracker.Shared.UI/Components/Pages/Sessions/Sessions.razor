@page "/sessions"
@namespace GoldTracker.Shared.UI.Components.Pages.Sessions
@using Archery.Shared.Models

<MudContainer MaxWidth="MaxWidth.False" Class="pa-4 archery-container">
    <MudText Typo="Typo.h5" Class="mb-4 font-weight-bold">Sessions</MudText>

    @if (_isLoading)
    {
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" Class="align-self-center my-4" />
    }
    else if (!_sessions.Any())
    {
        <MudPaper Class="pa-8 d-flex flex-column align-center justify-center mud-width-full glass-panel-secondary" Elevation="0">
            <MudIcon Icon="@Icons.Material.Filled.History" Size="Size.Large" Color="Color.Default" Class="mb-4" Style="opacity: 0.5;" />
            <MudText Typo="Typo.h6" Align="Align.Center" Color="Color.Default" Style="opacity: 0.7;">No sessions yet</MudText>
            <MudText Typo="Typo.body2" Align="Align.Center" Color="Color.Default" Class="mb-4" Style="opacity: 0.5;">Start a new practice session to track your progress.</MudText>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" OnClick="StartNewSession" Class="rounded-lg">Start Session</MudButton>
        </MudPaper>
    }
    else
    {
        <MudStack Spacing="3">
            @foreach (var session in _sessions)
            {
                <MudPaper @onclick="() => NavigateToSession(session.Id)" Class="cursor-pointer session-card glass-panel-secondary pa-4" Elevation="0">
                    <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                        <MudStack Spacing="0">
                            <MudText Typo="Typo.h6" Class="font-weight-bold" Color="Color.Primary">@session.StartTime.ToString("MMM dd")</MudText>
                            <MudText Typo="Typo.caption" Style="opacity: 0.7;">@session.StartTime.ToString("yyyy â€¢ HH:mm")</MudText>
                            @if (!string.IsNullOrEmpty(session.Topic))
                            {
                                <MudText Typo="Typo.body2" Class="mt-1" Color="Color.Secondary">@session.Topic</MudText>
                            }
                        </MudStack>
                        <MudStack AlignItems="AlignItems.End" Spacing="0">
                             <MudText Typo="Typo.h4" Class="font-weight-bold">@session.TotalScore</MudText>
                             <MudText Typo="Typo.caption" Style="opacity: 0.6;">Total Score</MudText>
                        </MudStack>
                    </MudStack>
                    
                    <MudDivider Class="my-3" Light="true" />
                    
                    <MudStack Row="true" Justify="Justify.SpaceBetween">
                        <MudStack AlignItems="AlignItems.Center" Spacing="0">
                            <MudText Typo="Typo.subtitle2" Class="font-weight-bold">@session.Ends.Count</MudText>
                            <MudText Typo="Typo.caption" Style="opacity: 0.6;">Ends</MudText>
                        </MudStack>
                        <MudStack AlignItems="AlignItems.Center" Spacing="0">
                            <MudText Typo="Typo.subtitle2" Class="font-weight-bold">@session.TotalArrows</MudText>
                            <MudText Typo="Typo.caption" Style="opacity: 0.6;">Arrows</MudText>
                        </MudStack>
                        <MudStack AlignItems="AlignItems.Center" Spacing="0">
                             <MudText Typo="Typo.subtitle2" Class="font-weight-bold" Color="@(session.ArrowAverage >= 9 ? Color.Warning : Color.Default)">@session.ArrowAverage.ToString("F1")</MudText>
                             <MudText Typo="Typo.caption" Style="opacity: 0.6;">Avg</MudText>
                        </MudStack>
                    </MudStack>
                </MudPaper>
            }
        </MudStack>
    }
    
    <MudFab Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" Style="position: fixed; bottom: 86px; right: 16px;" OnClick="StartNewSession" />

    <style>
        .glass-panel-secondary {
            background: var(--mud-palette-surface);
            border: 1px solid var(--mud-palette-lines-default);
            border-radius: 20px;
            transition: background-color 0.2s, transform 0.2s;
        }
        .session-card:active {
            background-color: var(--mud-palette-action-pressed);
            transform: scale(0.99);
        }
    </style>

</MudContainer>
